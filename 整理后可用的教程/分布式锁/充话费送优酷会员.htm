<!DOCTYPE html>
<!-- saved from url=(0101)http://172.16.1.121:9001/phoneCharge/default/huafei_ykhy_gdlt?digest=651516A1C9905BCF&prod_channel=33 -->
<html style="font-size: 55.2px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="./充话费送优酷会员_files/hf_ykhy_gdlt.css">
    <script charset="utf-8" src="./充话费送优酷会员_files/UrlChangeTracker.js"></script><script src="./充话费送优酷会员_files/hm.js"></script><script src="./充话费送优酷会员_files/rem.js"></script>
    <title>充话费送优酷会员</title>
    <script>
        //百度统计代码
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?3a52be5f5243c4fedd07571078bce9a6";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body style="">
<div id="contract" class="contract-page"><div id="topback"><i onclick="history.go(-1)" class="iconfont fanhui">返回</i>
        优酷会员免费领
    </div> <div class="page-title"><img src="./充话费送优酷会员_files/toppic_hf_ykhy_gdlt.png" alt=""> <div class="titlebox"><div class="titlebox-desc">请输入广东联通手机号码查询优惠： </div> <div class="titlebox-content"><div class="titlebox-content-num"><input id="mobile" type="text" maxlength="13" placeholder="请输入手机号码"></div> <div id="changePhone" class="titlebox-content-change">更换号码</div></div></div></div> <div class="page-product"><div class="page-product-inner"><div class="product-title"><img src="./充话费送优酷会员_files/ykhy_gdlt_title.png" alt=""></div> <ul class="product-list clearfix"><li class="product-list-li"><div><span class="price price1">充<span>100</span><i>元</i></span> <span class="price price2">送<span>2</span><i>个月优酷会员</i></span> <span class="pay-btn">支付100元</span></div> <div class="use-rule">100元话费立即到账，优酷会员当月起分月赠送2个月</div></li><li class="product-list-li"><div><span class="price price1">充<span>200</span><i>元</i></span> <span class="price price2">送<span>6</span><i>个月优酷会员</i></span> <span class="pay-btn">支付200元</span></div> <div class="use-rule">200元话费立即到账，优酷会员当月起分月赠送6个月</div></li></ul></div></div> <div class="product-rule"><ul class="rule-ul" style="border: 1px dashed white; border-radius: 5px; padding: 0.45rem 0.3rem 0.3rem;"><div><img src="./充话费送优酷会员_files/active_rule.png" style="width: 3.05rem; position: absolute; left: 50%; top: -0.4rem; display: block; transform: translate(-50%, 0px);"></div> <li class="rule-li"><div class="rule-li-content" style="font-weight: bold;">活动流程：</div></li> <li class="rule-li"><div class="rule-li-content">1.在本页面充值话费；</div></li> <li class="rule-li"><div class="rule-li-content">2.充值成功后前往会员领取页面领取优酷会员；</div></li> <li class="rule-li"><div class="rule-li-content">会员领取地址：<span style="color: orange;">https://u.10010.cn/qAMVy</span> <a href="https://u.10010.cn/qAMVy" style="background: white; color: rgb(45, 98, 185); padding: 5px; margin-left: 0.1rem;">前往领取</a></div></li> <li class="rule-li"><div class="rule-li-content">&nbsp;</div></li> <li class="rule-li"><div class="rule-li-content" style="font-weight: bold;">注意事项：</div></li> <li class="rule-li"><div class="rule-li-content">1.活动时间：2020年4月1日--2020年12月31日；</div></li> <li class="rule-li"><div class="rule-li-content">2.该活动仅限部分广东联通用户参与；</div></li> <li class="rule-li"><div class="rule-li-content">3.活动参与资格以查询结果为准；</div></li> <li class="rule-li"><div class="rule-li-content">4.每位用户在活动期间仅限参与一次；</div></li> <li class="rule-li"><div class="rule-li-content">5.充值话费当日到账，赠送会员当月起分月赠送。</div></li></ul></div> <div class="paybox"><div class="head"><span class="close-pay"><img src="./充话费送优酷会员_files/contract-delete.png" alt="" style="width: 0.6rem;"></span>
            确认充值号码
        </div> <div class="tishi">温馨提示：请仔细核对号码，充错号码无法退回～</div> <div class="recharge-pay-mobile"></div> <ul class="content-info"><li class="info-li"><div class="info-li-name">话费面值: </div> <div class="info-li-text flow-product-value">NaN元</div></li> <li class="info-li"><div class="info-li-name">实付金额: </div> <div class="info-li-text price">元</div></li> <li class="info-li"><div class="info-li-name">活动优惠: </div> <div class="info-li-text sale"></div></li></ul> <ul class="pay-way-wrap"><li class="pay-weixin"><span><img src="./充话费送优酷会员_files/icon-wxpay.png" width="25">微信</span> <span value="8" class="value active"><img src="./充话费送优酷会员_files/icon-selected.png" width="15"></span></li> <li class="pay-alipay"><span><img src="./充话费送优酷会员_files/icon-alipay.png" width="25">支付宝</span> <span value="0" class="value"><img src="./充话费送优酷会员_files/icon-selected.png" width="15"></span></li></ul> <div class="btn-box"><button class="btn btn-block btn-pay">立即付款</button></div></div> <div class="modal-wrap modal-mobile-check"><div class="modal"><div class="title">确认办理</div> <div class="content"><div class="item item1">
                    验证码已下发至手机号 <span>130 6811 2852</span> <div>请输入验证码：</div></div> <div class="item" style="border: 0px;"><input type="text" maxlength="6" id="checkYzm" placeholder="请输入验证码" style="border-bottom: 1px solid rgb(189, 189, 189);"> <button type="button" id="getYzm" class="btn btn-gray">获取验证码</button></div></div> <div class="btn-box"><span id="cancelModalCheckMobile">取消办理</span> <span id="subscribeFlowTc" style="color: rgb(51, 145, 255);">确定办理</span></div></div></div> <div class="mask"></div></div>
<script type="text/javascript" src="./充话费送优酷会员_files/jquery-1.10.2.min.js"></script>
<script src="./充话费送优酷会员_files/vue@2.6.10.min.js"></script>
<script type="text/javascript" src="./充话费送优酷会员_files/common.min.js"></script>
<script type="application/javascript" src="./充话费送优酷会员_files/md5.js"></script>
<script>
    $(function () {
        var wait = 60;
        var timer = null;
        var contract = new Vue({
            el:'#contract',
            data:{
                active:-1,
                list:[],
                mobile: '',
                curItem:{},
                oldMobile:''
            },
            watch:{
                'mobile':function (newVal,oldVal) {
                    this.oldMobile = oldVal
                }
            },
            methods:{
                listenMobile:function (e) {
                    //this.mobile = e.target.value;
                    this.mobile = this.pasteMobile(e);
                    var mobile_r = this.mobile.replace(/ /g,'');
                    var mobilereg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;

                    if(mobile_r.length==11){
                        if (!mobilereg.test(mobile_r)) {
                            common.tip('请输入正确的手机号码')
                        }else{
                            localStorage.setItem('mobile',mobile_r);

                            this.getMobileInfo(mobile_r);
                        }
                    }
                },
                pasteMobile:function(e){
                    //手机344格式
                    let str = e.target.value.replace(/ /g, '').replace(/[^0-9]/g, '');
                    let len = str.length;
                    switch (true) {
                        case len > 11:
                            str = str.substr(0, 3) + ' ' + str.substr(3, 4) + ' ' + str.substr(7, 4);
                            e.target.value = str;
                            break;
                        case len > 7:
                            str = str.substr(0, 3) + ' ' + str.substr(3, 4) + ' ' + str.substr(7);
                            e.target.value = str;
                            break;
                        case len > 3:
                            str = str.substr(0, 3) + ' ' + str.substr(3);
                            e.target.value = str;
                            break;
                        default:
                            e.target.value = str;
                    }
                    return str;
                },
                fomatterTel:function(val, old) {//val: 当前input的值，old: input上次的值
                    alert(val);
                    var str = "";
                    var telLen = val.length;
                    if (old.length <= telLen) {
                        if (telLen === 4 || telLen === 9) {
                            var pre = val.substring(0, telLen-1);
                            var last = val.substr(telLen-1, 1);
                            str = pre + ' ' + last;
                        } else {
                            str = val;
                        }
                    } else {
                        if (telLen === 9 || telLen === 4) {
                            str = val.trim();
                        } else {
                            str = val;
                        }
                    }
                    return str;
                },
                mobileDown: function (tel) {
                    return tel.replace(/(\d{3})(\d{4})(\d{4})/,function (rs,$1,$2,$3){
                        return $1+" "+$2+" "+$3
                    });
                },
                getMobileInfo: function(customer) {
                    var self = this;
                    common.ajax("/public/getMobileInfo",{"customer": customer},{
                        success:function (data) {
                            var areaName = data.mobileInfo.areaName;
                            var carrierName = data.mobileInfo.carrierName;
                            if(areaName=='广东' && carrierName=='联通'){
                                self.getList();
                            }else{
                                common.tip('请输入广东联通手机号码');
                                $('.product-list').html("<li class='nodata'><img src='/static/img/huafei/nodata-girl.png' style='width:1.12rem;'><div style='margin-top: .2rem'>请输入广东联通手机号码</div></li>")
                            }
                        },
                        error:function (code,msg) {
                            common.tip(msg);
                            $('.product-list').html("<li class='nodata'><img src='/static/img/huafei/nodata-girl.png' style='width:1.12rem;'><div style='margin-top: .2rem'>"+msg+"</div></li>")
                        }
                    })
                },
                getList:function () {
                    var self = this;
                    common.loadingShow('优惠查询中..');
                    common.ajax('/cz/recharge/getActivityProdDetail',{
                        customer:localStorage.getItem('mobile'),
                        prod_channel:common.getQuery('prod_channel')
                    },{
                        success:function (data) {
                            self.list = data.data;
                            if(self.list.length==0){
                                $('.product-list').html("<li class='nodata'><img src='/static/img/huafei/nodata-girl.png' style='width:1.12rem;'><div style='margin-top: .2rem'>该号码暂无专属优惠，您可以换个号码试试..</div></li>");
                            }else{
                                for(i = 0;i < self.list.length;i++){
                                    self.list[i].month = JSON.parse(self.list[i].extraData).month;
                                    var payPrice = parseInt(self.list[i].appPrice);
                                    self.list[i].payPrice = payPrice % 100 == 0?payPrice/100:(payPrice / 100).toFixed(2);
                                }
                                //self.active = self.list[0].id;
                                $('.product-list').find('li.nodata').remove();
                            }
                        },
                        error:function (code,msg) {
                            $('.product-list').html("<li class='nodata'><img src='/static/img/huafei/nodata-girl.png' style='width:1.12rem;'><div style='margin-top: .2rem'>"+msg+"</div></li>");
                            common.tip(msg)
                        }
                    })
                },
                listClick: function(item){
                    clearTimeout(timer);
                    var self = this;
                    var mobilereg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;
                    var mobile_r = self.mobile.replace(/ /g,'');

                    if (mobile_r =='') {
                        common.tip('请输入手机号码');
                        return
                    }
                    if (!mobilereg.test(mobile_r)) {
                        common.tip('请输入正确的手机号码');
                        return
                    }

                    this.curItem = item;
                    common.loadingShow('加载中');
                    common.ajax("/phoneCharge/default/getBypassProviderType",{
                        "customer": mobile_r,
                        "prodId": this.curItem.prodId
                    },{
                        success:function (data) {
                            $('body').addClass('fixed');
                            $('.mask').show();
                            $('.paybox').addClass('open');

                            $('#getYzm').html('获取验证码').removeAttr('disabled');
                            $('.paybox .recharge-pay-mobile').html(mobileReplace(mobile_r));
                        },
                        error:function (code,msg) {
                            common.tip(msg)
                        }
                    });


                }
            },
            mounted:function () {

                var self = this;

                self.mobile = this.mobileDown(localStorage.getItem('mobile'));

                var mobile_r = self.mobile.replace(/ /g,'');

                self.getMobileInfo(mobile_r);

                //关闭付款弹窗
                $('.close-pay').on('click',function (e) {
                    $('.mask').hide();
                    $('.paybox').removeClass('open');
                    $('body').removeClass('fixed');
                });

                //选择付款方式
                $('.pay-way-wrap').on('click','li',function (e) {
                    e.preventDefault();
                    $('.pay-way-wrap li').find('.value').removeClass('active');
                    $(this).find('.value').addClass('active');
                    var payValue = $(this).attr('value');

                });

                //打开确认办理弹窗 -- 填写验证码
                $('.btn-pay').click(function () {
                    $('.paybox').removeClass('open');
                    //custConfirm  0:不发
                    var custConfirm = self.curItem.custConfirm;
                    if(custConfirm>0){
                        sendYzm();
                    }else{
                        //直接创建订单
                        createOrder('')
                    }
                   
                });

                //取消办理弹窗
                $('#cancelModalCheckMobile').click(function () {
                    $('.modal-mobile-check').removeClass('show');
                    $('.dinggou-box').hide();
                    $('.mask').hide();
                    clearTimeout(timer);
                    $('body').removeClass('fixed');
                });


                //重发验证码
                $('#getYzm').click(function () {

                    sendYzm(this);

                });

                //更换号码
                $('#changePhone').click(function () {
                    $('#mobile').val('').focus();
                    self.mobile = '';
                });
                
                
                //确定办理
                $('#subscribeFlowTc').click(function () {
                    var mobile = $('#mobile').val().replace(/ /g,'');
                    var yzmVal = $('#checkYzm').val();

                    if(yzmVal==''){
                        common.tip('请输入验证码');
                        return;
                    }


                    //校验验证码是否正确
                    common.loadingShow('加载中');
                    common.ajax('/cz/recharge/verifyCode',{
                        customer:mobile,
                        code:yzmVal,
                        productId:self.curItem.xpProdId
                    },{
                        success:function (data) {
                            //创建订单
                            createOrder(yzmVal)
                        }
                    });
                })

            }
        });
        
        function createOrder(yzm) {
            var mobile = $('#mobile').val().replace(/ /g,'');
            var prodId = contract.curItem.prodId;
            var payway = $('.pay-way-wrap li').find('.value.active').attr('value');
            var orderNo = '';

            common.loadingShow('加载中');
            common.ajax("/phoneCharge/default/createOrder",{
                "customer": mobile,
                "prodId": prodId,
                "smsCode": yzm,
                'action' :payway
            },{
                success:function (data) {
                    var orderNo = data.orderNo;
                    window.location.href = "/public/pay?action="+ payway +"&orderNo=" + orderNo + "&method=mobile&specialChannel=1";
                },
                error:function (code,msg) {
                    common.tip(msg)
                }
            });
        }

        // 手机号344
        function mobileReplace(tel){
            return tel.replace(/(\d{3})(\d{4})(\d{4})/,function (rs,$1,$2,$3){
                return $1+" "+$2+" "+$3
            });
        }


        function sendYzm(el) {

            wait = 60;

            common.loadingShow('加载中');

            el && $(el).attr('disabled','disabled').html('发送中');

            common.ajax('/cz/recharge/sendMessage',{
                customer:localStorage.getItem('mobile'),
                productId:contract.curItem.xpProdId
            },{
                success:function (data) {

                    $('.modal-mobile-check').addClass('show');
                    $('.mask').show();

                    time();

                },
                error:function (code,msg) {
                    el && $(el).removeAttr('disabled').html('获取验证码');
                    common.tip(msg)
                }
            })
        }



        function time() {
            if(wait==0){
                $('#getYzm').html('获取验证码').removeAttr('disabled');
                wait = 60;
            }else{
                wait--;
                $('#getYzm').html(wait+'s').attr('disabled','true');
                timer = setTimeout(function () {
                    time();
                },1000);
            }
        }

    });
</script>


</body></html>